{
  "text": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Open World City</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js\"></script>\n    <style>\n        body { margin: 0; overflow: hidden; font-family: sans-serif; }\n        canvas { display: block; }\n        #minimap {\n            border: 2px solid white;\n            border-radius: 4px;\n        }\n        .minimap-dot {\n            position: absolute;\n            width: 4px;\n            height: 4px;\n            border-radius: 50%;\n        }\n        #instructions {\n            background: rgba(0, 0, 0, 0.7);\n            color: white;\n            padding: 10px;\n            border-radius: 5px;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-900\">\n    <!-- Game HUD -->\n    <div class=\"fixed inset-0 pointer-events-none\">\n        <!-- Mini-map -->\n        <div class=\"absolute top-4 right-4 w-48 h-48 bg-gray-800 opacity-80\" id=\"minimap\">\n            <div class=\"absolute inset-0\" id=\"minimapContent\"></div>\n        </div>\n        \n        <!-- Mission Status -->\n        <div class=\"absolute top-4 left-4 bg-black bg-opacity-70 text-white p-3 rounded-lg\">\n            <h3 class=\"font-bold text-yellow-400\">Mission</h3>\n            <p id=\"missionText\" class=\"text-sm\">Reach the destination marker</p>\n        </div>\n        \n        <!-- Controls Instructions -->\n        <div id=\"instructions\" class=\"absolute bottom-4 left-4\">\n            <h3 class=\"font-bold\">Controls</h3>\n            <p class=\"text-sm\">WASD: Move</p>\n            <p class=\"text-sm\">Space: Enter/Exit Vehicle</p>\n            <p class=\"text-sm\">Shift: Run</p>\n            <p class=\"text-sm\">E: Enter/Exit Vehicle</p>\n            <p class=\"text-sm\">Mouse: Look Around</p>\n        </div>\n        \n        <!-- Speedometer -->\n        <div class=\"absolute bottom-4 right-4 bg-black bg-opacity-70 text-white p-3 rounded-lg\">\n            <div class=\"flex items-center\">\n                <span class=\"text-sm mr-2\">Speed:</span>\n                <span id=\"speedometer\" class=\"font-bold text-lg\">0</span>\n                <span class=\"text-sm ml-1\">mph</span>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Game variables\n        let scene, camera, renderer;\n        let player, vehicle, isVehicle = false;\n        let buildings = [];\n        let missionMarker, missionPosition;\n        let velocity = new THREE.Vector3();\n        let direction = new THREE.Vector3();\n        let keys = {};\n        let clock = new THREE.Clock();\n        let minimapDots = [];\n        \n        // Initialize game\n        function init() {\n            // Create scene\n            scene = new THREE.Scene();\n            scene.fog = new THREE.Fog(0x87CEEB, 10, 500);\n            \n            // Create camera\n            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n            \n            // Create renderer\n            renderer = new THREE.WebGLRenderer({ antialias: true });\n            renderer.setSize(window.innerWidth, window.innerHeight);\n            renderer.shadowMap.enabled = true;\n            renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n            document.body.appendChild(renderer.domElement);\n            \n            // Add lighting\n            const ambientLight = new THREE.AmbientLight(0x404040, 2);\n            scene.add(ambientLight);\n            \n            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);\n            directionalLight.position.set(50, 100, 50);\n            directionalLight.castShadow = true;\n            directionalLight.shadow.camera.left = -100;\n            directionalLight.shadow.camera.right = 100;\n            directionalLight.shadow.camera.top = 100;\n            directionalLight.shadow.camera.bottom = -100;\n            directionalLight.shadow.mapSize.width = 2048;\n            directionalLight.shadow.mapSize.height = 2048;\n            scene.add(directionalLight);\n            \n            // Create ground\n            const groundGeometry = new THREE.PlaneGeometry(500, 500);\n            const groundMaterial = new THREE.MeshStandardMaterial({ \n                color: 0x333333,\n                roughness: 0.9\n            });\n            const ground = new THREE.Mesh(groundGeometry, groundMaterial);\n            ground.rotation.x = -Math.PI / 2;\n            ground.receiveShadow = true;\n            scene.add(ground);\n            \n            // Create roads\n            createRoads();\n            \n            // Create city buildings\n            createCity();\n            \n            // Create player\n            createPlayer();\n            \n            // Create vehicle\n            createVehicle();\n            \n            // Create mission marker\n            createMissionMarker();\n            \n            // Set up minimap\n            setupMinimap();\n            \n            // Add event listeners\n            setupControls();\n            \n            // Start game loop\n            animate();\n        }\n        \n        function createRoads() {\n            const roadMaterial = new THREE.MeshStandardMaterial({ \n                color: 0x222222,\n                roughness: 0.8\n            });\n            \n            // Horizontal roads\n            for (let i = -200; i <= 200; i += 100) {\n                const roadGeometry = new THREE.PlaneGeometry(20, 500);\n                const road = new THREE.Mesh(roadGeometry, roadMaterial);\n                road.rotation.x = -Math.PI / 2;\n                road.position.z = i;\n                road.receiveShadow = true;\n                scene.add(road);\n            }\n            \n            // Vertical roads\n            for (let i = -200; i <= 200; i += 100) {\n                const roadGeometry = new THREE.PlaneGeometry(500, 20);\n                const road = new THREE.Mesh(roadGeometry, roadMaterial);\n                road.rotation.x = -Math.PI / 2;\n                road.position.x = i;\n                road.receiveShadow = true;\n                scene.add(road);\n            }\n        }\n        \n        function createCity() {\n            const buildingColors = [0x8B4513, 0xCD853F, 0xA52A2A, 0xD2691E, 0x800020];\n            \n            for (let x = -200; x <= 200; x += 50) {\n                for (let z = -200; z <= 200; z += 50) {\n                    // Skip building placement on roads\n                    if ((x % 100 === 0) || (z % 100 === 0)) continue;\n                    \n                    const width = 15 + Math.random() * 15;\n                    const depth = 15 + Math.random() * 15;\n                    const height = 20 + Math.random() * 60;\n                    \n                    const buildingGeometry = new THREE.BoxGeometry(width, height, depth);\n                    const buildingMaterial = new THREE.MeshStandardMaterial({ \n                        color: buildingColors[Math.floor(Math.random() * buildingColors.length)],\n                        roughness: 0.7\n                    });\n                    \n                    const building = new THREE.Mesh(buildingGeometry, buildingMaterial);\n                    building.position.set(\n                        x + (Math.random() - 0.5) * 20,\n                        height / 2,\n                        z + (Math.random() - 0.5) * 20\n                    );\n                    building.castShadow = true;\n                    building.receiveShadow = true;\n                    \n                    buildings.push(building);\n                    scene.add(building);\n                }\n            }\n        }\n        \n        function createPlayer() {\n            const playerGroup = new THREE.Group();\n            \n            // Player body\n            const bodyGeometry = new THREE.BoxGeometry(0.8, 1.8, 0.4);\n            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x3498db });\n            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);\n            body.position.y = 0.9;\n            body.castShadow = true;\n            playerGroup.add(body);\n            \n            // Player head\n            const headGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);\n            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xfdbcb4 });\n            const head = new THREE.Mesh(headGeometry, headMaterial);\n            head.position.y = 1.8;\n            head.castShadow = true;\n            playerGroup.add(head);\n            \n            playerGroup.position.set(0, 0, 0);\n            scene.add(playerGroup);\n            player = playerGroup;\n        }\n        \n        function createVehicle() {\n            const vehicleGroup = new THREE.Group();\n            \n            // Car body\n            const bodyGeometry = new THREE.BoxGeometry(4, 1.5, 8);\n            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xe74c3c });\n            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);\n            body.position.y = 0.75;\n            body.castShadow = true;\n            vehicleGroup.add(body);\n            \n            // Car roof\n            const roofGeometry = new THREE.BoxGeometry(3.5, 1.2, 4);\n            const roofMaterial = new THREE.MeshStandardMaterial({ color: 0xc0392b });\n            const roof = new THREE.Mesh(roofGeometry, roofMaterial);\n            roof.position.y = 1.75;\n            roof.position.z = -0.5;\n            roof.castShadow = true;\n            vehicleGroup.add(roof);\n            \n            // Wheels\n            const wheelGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.3, 16);\n            const wheelMaterial = new THREE.MeshStandardMaterial({ color: 0x2c3e50 });\n            \n            const wheelPositions = [\n                { x: -1.5, y: 0.5, z: 2.5 },\n                { x: 1.5, y: 0.5, z: 2.5 },\n                { x: -1.5, y: 0.5, z: -2.5 },\n                { x: 1.5, y: 0.5, z: -2.5 }\n            ];\n            \n            wheelPositions.forEach(pos => {\n                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);\n                wheel.rotation.z = Math.PI / 2;\n                wheel.position.set(pos.x, pos.y, pos.z);\n                wheel.castShadow = true;\n                vehicleGroup.add(wheel);\n            });\n            \n            vehicleGroup.position.set(5, 0, 5);\n            vehicleGroup.visible = false;\n            scene.add(vehicleGroup);\n            vehicle = vehicleGroup;\n        }\n        \n        function createMissionMarker() {\n            const markerGroup = new THREE.Group();\n            \n            // Post\n            const postGeometry = new THREE.CylinderGeometry(0.1, 0.1, 4);\n            const postMaterial = new THREE.MeshStandardMaterial({ color: 0x2ecc71 });\n            const post = new THREE.Mesh(postGeometry, postMaterial);\n            post.position.y = 2;\n            post.castShadow = true;\n            markerGroup.add(post);\n            \n            // Flag\n            const flagGeometry = new THREE.PlaneGeometry(2, 1.5);\n            const flagMaterial = new THREE.MeshStandardMaterial({ \n                color: 0xe74c3c,\n                side: THREE.DoubleSide\n            });\n            const flag = new THREE.Mesh(flagGeometry, flagMaterial);\n            flag.position.set(1, 3.5, 0);\n            flag.castShadow = true;\n            markerGroup.add(flag);\n            \n            // Random position within the city\n            missionPosition = new THREE.Vector3(\n                (Math.random() - 0.5) * 300,\n                0,\n                (Math.random() - 0.5) * 300\n            );\n            markerGroup.position.copy(missionPosition);\n            \n            scene.add(markerGroup);\n            missionMarker = markerGroup;\n        }\n        \n        function setupMinimap() {\n            const minimapContent = document.getElementById('minimapContent');\n            \n            // Add player dot to minimap\n            const playerDot = document.createElement('div');\n            playerDot.className = 'minimap-dot bg-blue-500';\n            playerDot.id = 'minimapPlayer';\n            minimapContent.appendChild(playerDot);\n            \n            // Add vehicle dot to minimap\n            const vehicleDot = document.createElement('div');\n            vehicleDot.className = 'minimap-dot bg-red-500';\n            vehicleDot.id = 'minimapVehicle';\n            vehicleDot.style.display = 'none';\n            minimapContent.appendChild(vehicleDot);\n            \n            // Add mission marker to minimap\n            const missionDot = document.createElement('div');\n            missionDot.className = 'minimap-dot bg-yellow-500';\n            missionDot.style.width = '8px';\n            missionDot.style.height = '8px';\n            minimapContent.appendChild(missionDot);\n            \n            // Add building indicators to minimap\n            buildings.forEach(building => {\n                const dot = document.createElement('div');\n                dot.className = 'minimap-dot bg-gray-600';\n                minimapContent.appendChild(dot);\n                minimapDots.push({\n                    dot: dot,\n                    position: building.position\n                });\n            });\n            \n            minimapDots.push({\n                dot: missionDot,\n                position: missionPosition\n            });\n        }\n        \n        function updateMinimap() {\n            const mapSize = 192; // Size of minimap\n            const worldSize = 500; // Size of game world\n            const scale = mapSize / worldSize;\n            \n            // Update player position on minimap\n            const playerDot = document.getElementById('minimapPlayer');\n            if (playerDot && !isVehicle) {\n                const x = (player.position.x + worldSize/2) * scale;\n                const z = (player.position.z + worldSize/2) * scale;\n                playerDot.style.left = `${x - 2}px`;\n                playerDot.style.top = `${z - 2}px`;\n                playerDot.style.display = 'block';\n            } else if (playerDot) {\n                playerDot.style.display = 'none';\n            }\n            \n            // Update vehicle position on minimap\n            const vehicleDot = document.getElementById('minimapVehicle');\n            if (vehicleDot && isVehicle) {\n                const x = (vehicle.position.x + worldSize/2) * scale;\n                const z = (vehicle.position.z + worldSize/2) * scale;\n                vehicleDot.style.left = `${x - 2}px`;\n                vehicleDot.style.top = `${z - 2}px`;\n                vehicleDot.style.display = 'block';\n            } else if (vehicleDot) {\n                vehicleDot.style.display = 'none';\n            }\n            \n            // Update buildings and mission marker on minimap\n            minimapDots.forEach(item => {\n                const x = (item.position.x + worldSize/2) * scale;\n                const z = (item.position.z + worldSize/2) * scale;\n                item.dot.style.left = `${x - 2}px`;\n                item.dot.style.top = `${z - 2}px`;\n            });\n        }\n        \n        function setupControls() {\n            // Keyboard controls\n            document.addEventListener('keydown', (event) => {\n                keys[event.code] = true;\n                \n                if (event.code === 'Space' || event.code === 'KeyE') {\n                    toggleVehicle();\n                }\n            });\n            \n            document.addEventListener('keyup', (event) => {\n                keys[event.code] = false;\n            });\n            \n            // Mouse controls\n            document.addEventListener('mousemove', (event) => {\n                if (document.pointerLockElement === renderer.domElement) {\n                    const deltaX = event.movementX * 0.002;\n                    const deltaY = event.movementY * 0.002;\n                    \n                    // Rotate player or vehicle\n                    const target = isVehicle ? vehicle : player;\n                    target.rotation.y -= deltaX;\n                }\n            });\n            \n            renderer.domElement.addEventListener('click', () => {\n                renderer.domElement.requestPointerLock();\n            });\n            \n            // Window resize\n            window.addEventListener('resize', () => {\n                camera.aspect = window.innerWidth / window.innerHeight;\n                camera.updateProjectionMatrix();\n                renderer.setSize(window.innerWidth, window.innerHeight);\n            });\n        }\n        \n        function toggleVehicle() {\n            const distance = player.position.distanceTo(vehicle.position);\n            \n            if (distance < 5) {\n                isVehicle = !isVehicle;\n                player.visible = !isVehicle;\n                vehicle.visible = isVehicle;\n                \n                // Position player at vehicle when exiting\n                if (!isVehicle) {\n                    player.position.copy(vehicle.position);\n                    player.rotation.y = vehicle.rotation.y;\n                }\n            }\n        }\n        \n        function updatePlayer(delta) {\n            if (isVehicle) return;\n            \n            const speed = keys['ShiftLeft'] ? 8 : 4;\n            direction.set(0, 0, 0);\n            \n            if (keys['KeyW']) direction.z -= 1;\n            if (keys['KeyS']) direction.z += 1;\n            if (keys['KeyA']) direction.x -= 1;\n            if (keys['KeyD']) direction.x += 1;\n            \n            direction.normalize();\n            direction.multiplyScalar(speed * delta);\n            direction.applyQuaternion(player.quaternion);\n            \n            // Check collisions\n            const newPosition = player.position.clone().add(direction);\n            let collision = false;\n            \n            buildings.forEach(building => {\n                const buildingBox = new THREE.Box3().setFromObject(building);\n                const playerBox = new THREE.Box3().setFromObject(player);\n                playerBox.translate(direction);\n                \n                if (buildingBox.intersectsBox(playerBox)) {\n                    collision = true;\n                }\n            });\n            \n            if (!collision) {\n                player.position.add(direction);\n            }\n        }\n        \n        function updateVehicle(delta) {\n            if (!isVehicle) return;\n            \n            const maxSpeed = 50;\n            const acceleration = 15;\n            const turnSpeed = 1.5;\n            \n            let targetSpeed = 0;\n            let targetTurn = 0;\n            \n            if (keys['KeyW']) targetSpeed = maxSpeed;\n            if (keys['KeyS']) targetSpeed = -maxSpeed * 0.5;\n            if (keys['KeyA']) targetTurn = turnSpeed;\n            if (keys['KeyD']) targetTurn = -turnSpeed;\n            \n            // Accelerate/decelerate\n            if (vehicle.userData.speed === undefined) vehicle.userData.speed = 0;\n            vehicle.userData.speed += (targetSpeed - vehicle.userData.speed) * acceleration * delta;\n            \n            // Turn\n            if (Math.abs(vehicle.userData.speed) > 0.1) {\n                vehicle.rotation.y += targetTurn * delta * (vehicle.userData.speed / maxSpeed);\n            }\n            \n            // Apply speed in forward direction\n            const forward = new THREE.Vector3(0, 0, -1);\n            forward.applyQuaternion(vehicle.quaternion);\n            forward.multiplyScalar(vehicle.userData.speed * delta);\n            \n            // Check collisions\n            const newPosition = vehicle.position.clone().add(forward);\n            let collision = false;\n            \n            buildings.forEach(building => {\n                const buildingBox = new THREE.Box3().setFromObject(building);\n                const vehicleBox = new THREE.Box3().setFromObject(vehicle);\n                vehicleBox.translate(forward);\n                \n                if (buildingBox.intersectsBox(vehicleBox)) {\n                    collision = true;\n                }\n            });\n            \n            if (!collision) {\n                vehicle.position.add(forward);\n            } else {\n                vehicle.userData.speed *= 0.5; // Slow down on collision\n            }\n            \n            // Update speedometer\n            const displaySpeed = Math.round(Math.abs(vehicle.userData.speed) * 2);\n            document.getElementById('speedometer').textContent = displaySpeed;\n        }\n        \n        function checkMission() {\n            const target = isVehicle ? vehicle : player;\n            const distance = target.position.distanceTo(missionPosition);\n            \n            if (distance < 10) {\n                document.getElementById('missionText').textContent = \"Mission Complete!\";\n                document.getElementById('missionText').className = \"text-sm text-green-400\";\n                \n                // Create new mission\n                setTimeout(() => {\n                    missionPosition = new THREE.Vector3(\n                        (Math.random() - 0.5) * 300,\n                        0,\n                        (Math.random() - 0.5) * 300\n                    );\n                    missionMarker.position.copy(missionPosition);\n                    document.getElementById('missionText').textContent = \"Reach the destination marker\";\n                    document.getElementById('missionText').className = \"text-sm\";\n                }, 3000);\n            }\n        }\n        \n        function updateCamera() {\n            const target = isVehicle ? vehicle : player;\n            const offset = new THREE.Vector3(0, 5, 10);\n            \n            // Apply camera rotation\n            offset.applyQuaternion(target.quaternion);\n            \n            // Set camera position\n            camera.position.copy(target.position).add(offset);\n            \n            // Look at the target\n            camera.lookAt(target.position);\n        }\n        \n        function animate() {\n            requestAnimationFrame(animate);\n            \n            const delta = clock.getDelta();\n            \n            updatePlayer(delta);\n            updateVehicle(delta);\n            updateCamera();\n            updateMinimap();\n            checkMission();\n            \n            renderer.render(scene, camera);\n        }\n        \n        // Start the game\n        init();\n    </script>\n</body>\n</html>"
}