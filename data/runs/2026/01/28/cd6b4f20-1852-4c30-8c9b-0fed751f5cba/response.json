{
  "text": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Photo Editor Pro</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <style>\n        .tool-active {\n            background-color: rgb(99 102 241) !important;\n            color: white !important;\n        }\n        .layer-active {\n            background-color: rgb(219 234 254) !important;\n            border: 1px solid rgb(96 165 250) !important;\n        }\n        #canvas-container {\n            cursor: crosshair;\n        }\n        #canvas-container.hand-tool {\n            cursor: grab;\n        }\n        #canvas-container.hand-tool:active {\n            cursor: grabbing;\n        }\n        #canvas-container.zoom-tool {\n            cursor: zoom-in;\n        }\n        #canvas-container.eyedropper-tool {\n            cursor: crosshair;\n        }\n        .history-item:hover {\n            background-color: rgb(243 244 246);\n        }\n        .history-item.active {\n            background-color: rgb(219 234 254);\n            border-left: 3px solid rgb(59 130 246);\n        }\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        .fade-in {\n            animation: fadeIn 0.3s ease-out;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-100 text-gray-800 overflow-hidden\">\n    <!-- Header -->\n    <header class=\"bg-gray-800 text-white p-2 flex items-center justify-between shadow-lg\">\n        <div class=\"flex items-center space-x-4\">\n            <h1 class=\"text-xl font-bold flex items-center\">\n                <i class=\"fas fa-palette mr-2\"></i> Photo Editor Pro\n            </h1>\n            <nav class=\"flex space-x-1\">\n                <button class=\"px-3 py-1 hover:bg-gray-700 rounded\" onclick=\"app.newDocument()\">\n                    <i class=\"fas fa-file mr-1\"></i> New\n                </button>\n                <button class=\"px-3 py-1 hover:bg-gray-700 rounded\" onclick=\"document.getElementById('file-input').click()\">\n                    <i class=\"fas fa-folder-open mr-1\"></i> Open\n                </button>\n                <input type=\"file\" id=\"file-input\" accept=\"image/*\" class=\"hidden\" onchange=\"app.openImage(event)\">\n                <button class=\"px-3 py-1 hover:bg-gray-700 rounded\" onclick=\"app.saveImage()\">\n                    <i class=\"fas fa-save mr-1\"></i> Save\n                </button>\n            </nav>\n        </div>\n        <div class=\"flex items-center space-x-4\">\n            <div class=\"text-sm\">\n                <span class=\"opacity-75\">Zoom:</span>\n                <span id=\"zoom-level\" class=\"font-mono\">100%</span>\n            </div>\n            <div class=\"text-sm\">\n                <span id=\"cursor-position\">X: 0, Y: 0</span>\n            </div>\n        </div>\n    </header>\n\n    <!-- Main Content -->\n    <div class=\"flex h-screen pt-10\">\n        <!-- Left Panel - Tools -->\n        <div class=\"w-16 bg-gray-200 shadow-lg flex flex-col items-center py-4 space-y-2\">\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"move\" title=\"Move Tool (V)\">\n                <i class=\"fas fa-arrows-alt\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"rect\" title=\"Rectangle Selection (M)\">\n                <i class=\"fas fa-square\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"lasso\" title=\"Lasso Tool (L)\">\n                <i class=\"fas fa-draw-polygon\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"magicwand\" title=\"Magic Wand (W)\">\n                <i class=\"fas fa-wand-magic-sparkles\"></i>\n            </button>\n            <div class=\"h-px w-8 bg-gray-400 my-2\"></div>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg tool-active\" data-tool=\"brush\" title=\"Brush Tool (B)\">\n                <i class=\"fas fa-paint-brush\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"pencil\" title=\"Pencil Tool (P)\">\n                <i class=\"fas fa-pencil\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"eraser\" title=\"Eraser Tool (E)\">\n                <i class=\"fas fa-eraser\"></i>\n            </button>\n            <div class=\"h-px w-8 bg-gray-400 my-2\"></div>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"clonestamp\" title=\"Clone Stamp (S)\">\n                <i class=\"fas fa-stamp\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"text\" title=\"Text Tool (T)\">\n                <i class=\"fas fa-font\"></i>\n            </button>\n            <div class=\"h-px w-8 bg-gray-400 my-2\"></div>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"eyedropper\" title=\"Eye Dropper (I)\">\n                <i class=\"fas fa-eye-dropper\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"zoom\" title=\"Zoom Tool (Z)\">\n                <i class=\"fas fa-search-plus\"></i>\n            </button>\n            <button class=\"tool-btn w-12 h-12 flex items-center justify-center bg-white hover:bg-gray-300 rounded-lg\" data-tool=\"hand\" title=\"Hand Tool (H)\">\n                <i class=\"fas fa-hand-paper\"></i>\n            </button>\n        </div>\n\n        <!-- Canvas Area -->\n        <div class=\"flex-1 bg-gray-300 flex items-center justify-center relative overflow-hidden\">\n            <div id=\"canvas-container\" class=\"relative bg-white shadow-2xl\">\n                <canvas id=\"main-canvas\" width=\"800\" height=\"600\"></canvas>\n                <canvas id=\"overlay-canvas\" width=\"800\" height=\"600\" class=\"absolute top-0 left-0 pointer-events-none\"></canvas>\n            </div>\n            \n            <!-- Color Picker -->\n            <div class=\"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-3 fade-in\">\n                <div class=\"flex space-x-3\">\n                    <div class=\"flex flex-col items-center\">\n                        <div id=\"primary-color\" class=\"w-12 h-12 border-2 border-gray-300 rounded cursor-pointer\" style=\"background-color: #000000\"></div>\n                        <span class=\"text-xs mt-1\">Primary</span>\n                    </div>\n                    <div class=\"flex flex-col items-center\">\n                        <div id=\"secondary-color\" class=\"w-12 h-12 border-2 border-gray-300 rounded cursor-pointer\" style=\"background-color: #FFFFFF\"></div>\n                        <span class=\"text-xs mt-1\">Secondary</span>\n                    </div>\n                </div>\n                <input type=\"color\" id=\"color-picker\" class=\"mt-3 w-full h-8 cursor-pointer\">\n                <div class=\"mt-2 text-xs\">\n                    <input type=\"text\" id=\"hex-input\" class=\"w-full border rounded px-1 py-1 font-mono\" value=\"#000000\">\n                </div>\n            </div>\n        </div>\n\n        <!-- Right Panel - Layers and Adjustments -->\n        <div class=\"w-80 bg-gray-200 shadow-lg flex flex-col\">\n            <!-- Tabs -->\n            <div class=\"flex border-b border-gray-300\">\n                <button class=\"flex-1 py-3 px-4 bg-white border-b-2 border-blue-500 font-medium\" onclick=\"app.switchTab('layers')\">\n                    Layers\n                </button>\n                <button class=\"flex-1 py-3 px-4 hover:bg-gray-100 font-medium\" onclick=\"app.switchTab('adjustments')\">\n                    Adjustments\n                </button>\n                <button class=\"flex-1 py-3 px-4 hover:bg-gray-100 font-medium\" onclick=\"app.switchTab('filters')\">\n                    Filters\n                </button>\n            </div>\n\n            <!-- Layers Panel -->\n            <div id=\"layers-panel\" class=\"flex-1 overflow-y-auto p-3 bg-white\">\n                <div class=\"flex justify-between items-center mb-3\">\n                    <h3 class=\"font-semibold\">Layers</h3>\n                    <div class=\"flex space-x-1\">\n                        <button class=\"p-1 hover:bg-gray-200 rounded\" onclick=\"app.addLayer()\" title=\"Add Layer\">\n                            <i class=\"fas fa-plus\"></i>\n                        </button>\n                        <button class=\"p-1 hover:bg-gray-200 rounded\" onclick=\"app.deleteLayer()\" title=\"Delete Layer\">\n                            <i class=\"fas fa-trash\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div id=\"layers-list\" class=\"space-y-2\">\n                    <!-- Layers will be dynamically added here -->\n                </div>\n            </div>\n\n            <!-- Adjustments Panel -->\n            <div id=\"adjustments-panel\" class=\"flex-1 overflow-y-auto p-3 bg-white hidden\">\n                <h3 class=\"font-semibold mb-3\">Adjustments</h3>\n                \n                <div class=\"space-y-4\">\n                    <div>\n                        <label class=\"block text-sm font-medium mb-1\">Brightness</label>\n                        <input type=\"range\" id=\"brightness\" min=\"-100\" max=\"100\" value=\"0\" class=\"w-full\" onchange=\"app.applyAdjustment('brightness', this.value)\">\n                        <div class=\"flex justify-between text-xs text-gray-500\">\n                            <span>-100</span>\n                            <span id=\"brightness-value\">0</span>\n                            <span>100</span>\n                        </div>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium mb-1\">Contrast</label>\n                        <input type=\"range\" id=\"contrast\" min=\"-100\" max=\"100\" value=\"0\" class=\"w-full\" onchange=\"app.applyAdjustment('contrast', this.value)\">\n                        <div class=\"flex justify-between text-xs text-gray-500\">\n                            <span>-100</span>\n                            <span id=\"contrast-value\">0</span>\n                            <span>100</span>\n                        </div>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium mb-1\">Hue</label>\n                        <input type=\"range\" id=\"hue\" min=\"0\" max=\"360\" value=\"0\" class=\"w-full\" onchange=\"app.applyAdjustment('hue', this.value)\">\n                        <div class=\"flex justify-between text-xs text-gray-500\">\n                            <span>0</span>\n                            <span id=\"hue-value\">0</span>\n                            <span>360</span>\n                        </div>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium mb-1\">Saturation</label>\n                        <input type=\"range\" id=\"saturation\" min=\"-100\" max=\"100\" value=\"0\" class=\"w-full\" onchange=\"app.applyAdjustment('saturation', this.value)\">\n                        <div class=\"flex justify-between text-xs text-gray-500\">\n                            <span>-100</span>\n                            <span id=\"saturation-value\">0</span>\n                            <span>100</span>\n                        </div>\n                    </div>\n                    \n                    <button class=\"w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600\" onclick=\"app.resetAdjustments()\">\n                        Reset Adjustments\n                    </button>\n                </div>\n            </div>\n\n            <!-- Filters Panel -->\n            <div id=\"filters-panel\" class=\"flex-1 overflow-y-auto p-3 bg-white hidden\">\n                <h3 class=\"font-semibold mb-3\">Filters</h3>\n                <div class=\"space-y-2\">\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('grayscale')\">\n                        <i class=\"fas fa-adjust mr-2\"></i> Grayscale\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('sepia')\">\n                        <i class=\"fas fa-image mr-2\"></i> Sepia\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('invert')\">\n                        <i class=\"fas fa-exchange-alt mr-2\"></i> Invert\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('blur')\">\n                        <i class=\"fas fa-circle mr-2\"></i> Blur\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('sharpen')\">\n                        <i class=\"fas fa-angle-double-up mr-2\"></i> Sharpen\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('edge')\">\n                        <i class=\"fas fa-border-style mr-2\"></i> Edge Detect\n                    </button>\n                    <button class=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded text-left px-3\" onclick=\"app.applyFilter('emboss')\">\n                        <i class=\"fas fa-cube mr-2\"></i> Emboss\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Bottom Panel - History -->\n    <div class=\"fixed bottom-0 left-0 right-0 h-40 bg-gray-800 text-white shadow-lg\">\n        <div class=\"p-2 bg-gray-700 flex justify-between items-center\">\n            <h3 class=\"font-semibold text-sm\">History</h3>\n            <div class=\"flex space-x-2\">\n                <button class=\"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-sm\" onclick=\"app.undo()\">\n                    <i class=\"fas fa-undo mr-1\"></i> Undo (Ctrl+Z)\n                </button>\n                <button class=\"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-sm\" onclick=\"app.redo()\">\n                    <i class=\"fas fa-redo mr-1\"></i> Redo (Ctrl+Y)\n                </button>\n            </div>\n        </div>\n        <div id=\"history-panel\" class=\"p-3 overflow-y-auto h-32\">\n            <div id=\"history-list\" class=\"flex space-x-2\">\n                <!-- History items will be dynamically added here -->\n            </div>\n        </div>\n    </div>\n\n    <!-- Tool Options Bar -->\n    <div id=\"tool-options\" class=\"absolute top-16 left-20 bg-white rounded-lg shadow-lg p-3 fade-in\">\n        <div id=\"brush-options\" class=\"tool-options-content\">\n            <label class=\"text-sm font-medium\">Brush Size</label>\n            <input type=\"range\" id=\"brush-size\" min=\"1\" max=\"50\" value=\"5\" class=\"w-32\">\n            <span id=\"brush-size-value\" class=\"ml-2 text-sm\">5px</span>\n            \n            <div class=\"mt-2\">\n                <label class=\"text-sm font-medium\">Hardness</label>\n                <input type=\"range\" id=\"brush-hardness\" min=\"0\" max=\"100\" value=\"100\" class=\"w-32\">\n                <span id=\"brush-hardness-value\" class=\"ml-2 text-sm\">100%</span>\n            </div>\n        </div>\n        \n        <div id=\"eraser-options\" class=\"tool-options-content hidden\">\n            <label class=\"text-sm font-medium\">Eraser Size</label>\n            <input type=\"range\" id=\"eraser-size\" min=\"1\" max=\"50\" value=\"5\" class=\"w-32\">\n            <span id=\"eraser-size-value\" class=\"ml-2 text-sm\">5px</span>\n        </div>\n        \n        <div id=\"text-options\" class=\"tool-options-content hidden\">\n            <input type=\"text\" id=\"text-input\" placeholder=\"Enter text\" class=\"border rounded px-2 py-1 text-black w-40\">\n            <select id=\"font-family\" class=\"ml-2 border rounded px-1\">\n                <option>Arial</option>\n                <option>Helvetica</option>\n                <option>Times New Roman</option>\n                <option>Georgia</option>\n            </select>\n            <select id=\"font-size\" class=\"ml-2 border rounded px-1\">\n                <option>12</option>\n                <option>16</option>\n                <option>24</option>\n                <option>36</option>\n                <option>48</option>\n            </select>\n        </div>\n    </div>\n\n    <script>\n        // Photo Editor Application\n        const app = {\n            canvas: null,\n            ctx: null,\n            overlayCanvas: null,\n            overlayCtx: null,\n            currentTool: 'brush',\n            isDrawing: false,\n            lastX: 0,\n            lastY: 0,\n            primaryColor: '#000000',\n            secondaryColor: '#FFFFFF',\n            layers: [],\n            activeLayer: 0,\n            history: [],\n            historyStep: -1,\n            zoom: 1,\n            adjustments: {\n                brightness: 0,\n                contrast: 0,\n                hue: 0,\n                saturation: 0\n            },\n            \n            init() {\n                this.canvas = document.getElementById('main-canvas');\n                this.ctx = this.canvas.getContext('2d');\n                this.overlayCanvas = document.getElementById('overlay-canvas');\n                this.overlayCtx = this.overlayCanvas.getContext('2d');\n                \n                // Initialize with a white background\n                this.ctx.fillStyle = 'white';\n                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n                \n                // Create initial layer\n                this.addLayer();\n                \n                // Set up event listeners\n                this.setupEventListeners();\n                \n                // Add initial history state\n                this.saveHistory('New Document');\n            },\n            \n            setupEventListeners() {\n                // Canvas events\n                this.canvas.addEventListener('mousedown', this.startDrawing.bind(this));\n                this.canvas.addEventListener('mousemove', this.draw.bind(this));\n                this.canvas.addEventListener('mouseup', this.stopDrawing.bind(this));\n                this.canvas.addEventListener('mouseout', this.stopDrawing.bind(this));\n                this.canvas.addEventListener('mousemove', this.updateCursorPosition.bind(this));\n                \n                // Tool buttons\n                document.querySelectorAll('.tool-btn').forEach(btn => {\n                    btn.addEventListener('click', () => {\n                        this.selectTool(btn.dataset.tool);\n                    });\n                });\n                \n                // Color picker\n                const colorPicker = document.getElementById('color-picker');\n                colorPicker.addEventListener('change', (e) => {\n                    this.primaryColor = e.target.value;\n                    document.getElementById('primary-color').style.backgroundColor = e.target.value;\n                    document.getElementById('hex-input').value = e.target.value;\n                });\n                \n                const hexInput = document.getElementById('hex-input');\n                hexInput.addEventListener('change', (e) => {\n                    this.primaryColor = e.target.value;\n                    document.getElementById('primary-color').style.backgroundColor = e.target.value;\n                    colorPicker.value = e.target.value;\n                });\n                \n                // Brush options\n                const brushSize = document.getElementById('brush-size');\n                brushSize.addEventListener('input', (e) => {\n                    document.getElementById('brush-size-value').textContent = e.target.value + 'px';\n                });\n                \n                const brushHardness = document.getElementById('brush-hardness');\n                brushHardness.addEventListener('input', (e) => {\n                    document.getElementById('brush-hardness-value').textContent = e.target.value + '%';\n                });\n                \n                // Eraser options\n                const eraserSize = document.getElementById('eraser-size');\n                eraserSize.addEventListener('input', (e) => {\n                    document.getElementById('eraser-size-value').textContent = e.target.value + 'px';\n                });\n                \n                // Keyboard shortcuts\n                document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));\n            },\n            \n            selectTool(tool) {\n                this.currentTool = tool;\n                \n                // Update UI\n                document.querySelectorAll('.tool-btn').forEach(btn => {\n                    btn.classList.remove('tool-active');\n                });\n                document.querySelector(`[data-tool=\"${tool}\"]`).classList.add('tool-active');\n                \n                // Show/hide tool options\n                document.querySelectorAll('.tool-options-content').forEach(el => {\n                    el.classList.add('hidden');\n                });\n                \n                const canvasContainer = document.getElementById('canvas-container');\n                canvasContainer.className = '';\n                \n                if (tool === 'brush' || tool === 'eraser') {\n                    document.getElementById(`${tool}-options`).classList.remove('hidden');\n                    document.getElementById('tool-options').classList.remove('hidden');\n                } else if (tool === 'text') {\n                    document.getElementById('text-options').classList.remove('hidden');\n                    document.getElementById('tool-options').classList.remove('hidden');\n                } else {\n                    document.getElementById('tool-options').classList.add('hidden');\n                }\n                \n                // Update cursor\n                if (tool === 'eyedropper') {\n                    canvasContainer.classList.add('eyedropper-tool');\n                } else if (tool === 'hand') {\n                    canvasContainer.classList.add('hand-tool');\n                } else if (tool === 'zoom') {\n                    canvasContainer.classList.add('zoom-tool');\n                }\n            },\n            \n            startDrawing(e) {\n                if (this.currentTool === 'eyedropper') {\n                    this.pickColor(e);\n                    return;\n                }\n                \n                this.isDrawing = true;\n                const rect = this.canvas.getBoundingClientRect();\n                this.lastX = e.clientX - rect.left;\n                this.lastY = e.clientY - rect.top;\n                \n                if (this.currentTool === 'text') {\n                    this.addText(this.lastX, this.lastY);\n                    return;\n                }\n                \n                if (this.currentTool === 'rect' || this.currentTool === 'lasso') {\n                    // Initialize selection\n                    this.startX = this.lastX;\n                    this.startY = this.lastY;\n                }\n            },\n            \n            draw(e) {\n                if (!this.isDrawing) return;\n                \n                const rect = this.canvas.getBoundingClientRect();\n                const x = e.clientX - rect.left;\n                const y = e.clientY - rect.top;\n                \n                if (this.currentTool === 'brush') {\n                    this.drawBrush(x, y);\n                } else if (this.currentTool === 'eraser') {\n                    this.drawEraser(x, y);\n                } else if (this.currentTool === 'rect' || this.currentTool === 'lasso') {\n                    this.drawSelection(x, y);\n                }\n                \n                this.lastX = x;\n                this.lastY = y;\n            },\n            \n            stopDrawing() {\n                if (this.isDrawing) {\n                    this.isDrawing = false;\n                    this.saveHistory(`${this.currentTool} tool used`);\n                }\n            },\n            \n            drawBrush(x, y) {\n                const size = document.getElementById('brush-size').value;\n                const hardness = document.getElementById('brush-hardness').value;\n                \n                this.ctx.globalCompositeOperation = 'source-over';\n                this.ctx.strokeStyle = this.primaryColor;\n                this.ctx.lineWidth = size;\n                this.ctx.lineCap = 'round';\n                this.ctx.lineJoin = 'round';\n                \n                this.ctx.beginPath();\n                this.ctx.moveTo(this.lastX, this.lastY);\n                this.ctx.lineTo(x, y);\n                this.ctx.stroke();\n            },\n            \n            drawEraser(x, y) {\n                const size = document.getElementById('eraser-size').value;\n                \n                this.ctx.globalCompositeOperation = 'destination-out';\n                this.ctx.lineWidth = size;\n                this.ctx.lineCap = 'round';\n                this.ctx.lineJoin = 'round';\n                \n                this.ctx.beginPath();\n                this.ctx.moveTo(this.lastX, this.lastY);\n                this.ctx.lineTo(x, y);\n                this.ctx.stroke();\n                \n                this.ctx.globalCompositeOperation = 'source-over';\n            },\n            \n            drawSelection(x, y) {\n                this.overlayCtx.clearRect(0, 0, this.overlayCanvas.width, this.overlayCanvas.height);\n                \n                if (this.currentTool === 'rect') {\n                    this.overlayCtx.strokeStyle = '#0000FF';\n                    this.overlayCtx.lineWidth = 1;\n                    this.overlayCtx.setLineDash([5, 5]);\n                    \n                    const width = x - this.startX;\n                    const height = y - this.startY;\n                    \n                    this.overlayCtx.strokeRect(this.startX, this.startY, width, height);\n                    this.overlayCtx.setLineDash([]);\n                }\n            },\n            \n            addText(x, y) {\n                const text = document.getElementById('text-input').value;\n                if (!text) return;\n                \n                const fontSize = document.getElementById('font-size').value;\n                const fontFamily = document.getElementById('font-family').value;\n                \n                this.ctx.font = `${fontSize}px ${fontFamily}`;\n                this.ctx.fillStyle = this.primaryColor;\n                this.ctx.fillText(text, x, y);\n                \n                this.saveHistory(`Added text: \"${text}\"`);\n            },\n            \n            pickColor(e) {\n                const rect = this.canvas.getBoundingClientRect();\n                const x = Math.floor(e.clientX - rect.left);\n                const y = Math.floor(e.clientY - rect.top);\n                \n                const pixel = this.ctx.getImageData(x, y, 1, 1).data;\n                const hex = '#' + ('000000' + this.rgbToHex(pixel[0], pixel[1], pixel[2])).slice(-6);\n                \n                this.primaryColor = hex;\n                document.getElementById('primary-color').style.backgroundColor = hex;\n                document.getElementById('color-picker').value = hex;\n                document.getElementById('hex-input').value = hex;\n            },\n            \n            rgbToHex(r, g, b) {\n                return ((r << 16) | (g << 8) | b).toString(16);\n            },\n            \n            updateCursorPosition(e) {\n                const rect = this.canvas.getBoundingClientRect();\n                const x = Math.floor(e.clientX - rect.left);\n                const y = Math.floor(e.clientY - rect.top);\n                document.getElementById('cursor-position').textContent = `X: ${x}, Y: ${y}`;\n            },\n            \n            addLayer() {\n                const layerId = Date.now();\n                const layer = {\n                    id: layerId,\n                    name: `Layer ${this.layers.length + 1}`,\n                    visible: true,\n                    opacity: 100,\n                    blendMode: 'normal'\n                };\n                \n                this.layers.push(layer);\n                this.activeLayer = this.layers.length - 1;\n                this.updateLayersPanel();\n                this.saveHistory(`Added layer: ${layer.name}`);\n            },\n            \n            deleteLayer() {\n                if (this.layers.length <= 1) return;\n                \n                const deletedLayer = this.layers.splice(this.activeLayer, 1)[0];\n                this.activeLayer = Math.min(this.activeLayer, this.layers.length - 1);\n                this.updateLayersPanel();\n                this.saveHistory(`Deleted layer: ${deletedLayer.name}`);\n            },\n            \n            updateLayersPanel() {\n                const layersList = document.getElementById('layers-list');\n                layersList.innerHTML = '';\n                \n                this.layers.slice().reverse().forEach((layer, index) => {\n                    const actualIndex = this.layers.length - 1 - index;\n                    const layerEl = document.createElement('div');\n                    layerEl.className = `p-2 bg-gray-50 rounded border flex items-center justify-between ${actualIndex === this.activeLayer ? 'layer-active' : ''}`;\n                    layerEl.innerHTML = `\n                        <div class=\"flex items-center space-x-2\">\n                            <button class=\"w-5 h-5 flex items-center justify-center\" onclick=\"app.toggleLayerVisibility(${actualIndex})\">\n                                <i class=\"fas ${layer.visible ? 'fa-eye' : 'fa-eye-slash'} text-xs\"></i>\n                            </button>\n                            <span class=\"text-sm\">${layer.name}</span>\n                        </div>\n                        <div class=\"flex items-center space-x-1\">\n                            <select class=\"text-xs border rounded px-1\" onchange=\"app.updateLayerBlendMode(${actualIndex}, this.value)\">\n                                <option value=\"normal\" ${layer.blendMode === 'normal' ? 'selected' : ''}>Normal</option>\n                                <option value=\"multiply\" ${layer.blendMode === 'multiply' ? 'selected' : ''}>Multiply</option>\n                                <option value=\"screen\" ${layer.blendMode === 'screen' ? 'selected' : ''}>Screen</option>\n                                <option value=\"overlay\" ${layer.blendMode === 'overlay' ? 'selected' : ''}>Overlay</option>\n                                <option value=\"soft-light\" ${layer.blendMode === 'soft-light' ? 'selected' : ''}>Soft Light</option>\n                                <option value=\"hard-light\" ${layer.blendMode === 'hard-light' ? 'selected' : ''}>Hard Light</option>\n                                <option value=\"color-dodge\" ${layer.blendMode === 'color-dodge' ? 'selected' : ''}>Color Dodge</option>\n                                <option value=\"color-burn\" ${layer.blendMode === 'color-burn' ? 'selected' : ''}>Color Burn</option>\n                            </select>\n                            <button class=\"w-5 h-5 flex items-center justify-center hover:bg-gray-200 rounded\" onclick=\"app.selectLayer(${actualIndex})\">\n                                <i class=\"fas fa-check text-xs ${actualIndex === this.activeLayer ? 'visible' : 'invisible'}\"></i>\n                            </button>\n                        </div>\n                    `;\n                    layersList.appendChild(layerEl);\n                });\n            },\n            \n            toggleLayerVisibility(index) {\n                this.layers[index].visible = !this.layers[index].visible;\n                this.updateLayersPanel();\n                this.saveHistory(`${this.layers[index].visible ? 'Show' : 'Hide'} layer: ${this.layers[index].name}`);\n            },\n            \n            updateLayerBlendMode(index, blendMode) {\n                this.layers[index].blendMode = blendMode;\n                this.saveHistory(`Changed blend mode: ${this.layers[index].name} to ${blendMode}`);\n            },\n            \n            selectLayer(index) {\n                this.activeLayer = index;\n                this.updateLayersPanel();\n            },\n            \n            applyAdjustment(type, value) {\n                this.adjustments[type] = parseFloat(value);\n                document.getElementById(`${type}-value`).textContent = value;\n                this.applyImageAdjustments();\n                this.saveHistory(`Applied ${type}: ${value}`);\n            },\n            \n            applyImageAdjustments() {\n                // This is a simplified version - in a real app, you'd apply filters to the image data\n                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n                const data = imageData.data;\n                \n                // Apply brightness and contrast\n                const brightness = this.adjustments.brightness;\n                const contrast = (this.adjustments.contrast + 100) / 100;\n                \n                for (let i = 0; i < data.length; i += 4) {\n                    // Apply brightness\n                    data[i] += brightness;     // R\n                    data[i + 1] += brightness; // G\n                    data[i + 2] += brightness; // B\n                    \n                    // Apply contrast\n                    data[i] = ((data[i] - 128) * contrast) + 128;\n                    data[i + 1] = ((data[i + 1] - 128) * contrast) + 128;\n                    data[i + 2] = ((data[i + 2] - 128) * contrast) + 128;\n                    \n                    // Clamp values\n                    data[i] = Math.max(0, Math.min(255, data[i]));\n                    data[i + 1] = Math.max(0, Math.min(255, data[i + 1]));\n                    data[i + 2] = Math.max(0, Math.min(255, data[i + 2]));\n                }\n                \n                this.ctx.putImageData(imageData, 0, 0);\n            },\n            \n            resetAdjustments() {\n                Object.keys(this.adjustments).forEach(key => {\n                    this.adjustments[key] = 0;\n                    const slider = document.getElementById(key);\n                    if (slider) {\n                        slider.value = 0;\n                        document.getElementById(`${key}-value`).textContent = '0';\n                    }\n                });\n                this.saveHistory('Reset adjustments');\n            },\n            \n            applyFilter(filterType) {\n                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n                const data = imageData.data;\n                \n                switch (filterType) {\n                    case 'grayscale':\n                        for (let i = 0; i < data.length; i += 4) {\n                            const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;\n                            data[i] = gray;\n                            data[i + 1] = gray;\n                            data[i + 2] = gray;\n                        }\n                        break;\n                    \n                    case 'sepia':\n                        for (let i = 0; i < data.length; i += 4) {\n                            const r = data[i];\n                            const g = data[i + 1];\n                            const b = data[i + 2];\n                            \n                            data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));\n                            data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));\n                            data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));\n                        }\n                        break;\n                    \n                    case 'invert':\n                        for (let i = 0; i < data.length; i += 4) {\n                            data[i] = 255 - data[i];\n                            data[i + 1] = 255 - data[i + 1];\n                            data[i + 2] = 255 - data[i + 2];\n                        }\n                        break;\n                    \n                    case 'blur':\n                        // Simple box blur - not optimized\n                        const tempData = new Uint8ClampedArray(data);\n                        const width = this.canvas.width;\n                        const height = this.canvas.height;\n                        \n                        for (let y = 1; y < height - 1; y++) {\n                            for (let x = 1; x < width - 1; x++) {\n                                const idx = (y * width + x) * 4;\n                                \n                                for (let c = 0; c < 3; c++) {\n                                    let sum = 0;\n                                    for (let ky = -1; ky <= 1; ky++) {\n                                        for (let kx = -1; kx <= 1; kx++) {\n                                            const kidx = ((y + ky) * width + (x + kx)) * 4 + c;\n                                            sum += tempData[kidx];\n                                        }\n                                    }\n                                    data[idx + c] = sum / 9;\n                                }\n                            }\n                        }\n                        break;\n                }\n                \n                this.ctx.putImageData(imageData, 0, 0);\n                this.saveHistory(`Applied filter: ${filterType}`);\n            },\n            \n            saveHistory(action) {\n                // Save canvas state\n                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n                \n                // Remove any history after current step\n                this.history = this.history.slice(0, this.historyStep + 1);\n                \n                // Add new history entry\n                this.history.push({\n                    action: action,\n                    imageData: imageData,\n                    timestamp: new Date().toLocaleTimeString()\n                });\n                \n                this.historyStep++;\n                \n                // Update history panel\n                this.updateHistoryPanel();\n            },\n            \n            updateHistoryPanel() {\n                const historyList = document.getElementById('history-list');\n                historyList.innerHTML = '';\n                \n                this.history.forEach((entry, index) => {\n                    const historyItem = document.createElement('div');\n                    historyItem.className = `px-3 py-2 bg-gray-700 rounded text-sm cursor-pointer history-item ${index === this.historyStep ? 'active' : ''}`;\n                    historyItem.innerHTML = `\n                        <div class=\"font-medium\">${entry.action}</div>\n                        <div class=\"text-xs opacity-75\">${entry.timestamp}</div>\n                    `;\n                    historyItem.onclick = () => this.goToHistoryStep(index);\n                    historyList.appendChild(historyItem);\n                });\n                \n                // Scroll to active item\n                if (historyList.children.length > 0) {\n                    historyList.children[this.historyStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                }\n            },\n            \n            goToHistoryStep(step) {\n                if (step < 0 || step >= this.history.length) return;\n                \n                this.historyStep = step;\n                const imageData = this.history[step].imageData;\n                this.ctx.putImageData(imageData, 0, 0);\n                \n                this.updateHistoryPanel();\n            },\n            \n            undo() {\n                if (this.historyStep > 0) {\n                    this.goToHistoryStep(this.historyStep - 1);\n                }\n            },\n            \n            redo() {\n                if (this.historyStep < this.history.length - 1) {\n                    this.goToHistoryStep(this.historyStep + 1);\n                }\n            },\n            \n            newDocument() {\n                this.ctx.fillStyle = 'white';\n                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n                this.layers = [];\n                this.addLayer();\n                this.saveHistory('New Document');\n            },\n            \n            openImage(event) {\n                const file = event.target.files[0];\n                if (!file) return;\n                \n                const reader = new FileReader();\n                reader.onload = (e) => {\n                    const img = new Image();\n                    img.onload = () => {\n                        // Clear canvas\n                        this.ctx.fillStyle = 'white';\n                        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n                        \n                        // Calculate scaling to fit image\n                        const scale = Math.min(this.canvas.width / img.width, this.canvas.height / img.height);\n                        const x = (this.canvas.width - img.width * scale) / 2;\n                        const y = (this.canvas.height - img.height * scale) / 2;\n                        \n                        // Draw image\n                        this.ctx.drawImage(img, x, y, img.width * scale, img.height * scale);\n                        this.saveHistory('Opened image');\n                    };\n                    img.src = e.target.result;\n                };\n                reader.readAsDataURL(file);\n            },\n            \n            saveImage() {\n                const link = document.createElement('a');\n                link.download = 'photo-editor-image.png';\n                link.href = this.canvas.toDataURL();\n                link.click();\n                this.saveHistory('Saved image');\n            },\n            \n            switchTab(tab) {\n                // Update tab appearance\n                document.querySelectorAll('.flex.border-b button').forEach(btn => {\n                    btn.classList.remove('bg-white', 'border-b-2', 'border-blue-500');\n                    btn.classList.add('hover:bg-gray-100');\n                });\n                \n                event.target.classList.add('bg-white', 'border-b-2', 'border-blue-500');\n                event.target.classList.remove('hover:bg-gray-100');\n                \n                // Show/hide panels\n                document.getElementById('layers-panel').classList.add('hidden');\n                document.getElementById('adjustments-panel').classList.add('hidden');\n                document.getElementById('filters-panel').classList.add('hidden');\n                \n                document.getElementById(`${tab}-panel`).classList.remove('hidden');\n            },\n            \n            handleKeyboardShortcuts(e) {\n                // Ctrl/Cmd + Z: Undo\n                if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                    e.preventDefault();\n                    this.undo();\n                }\n                \n                // Ctrl/Cmd + Y: Redo\n                if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n                    e.preventDefault();\n                    this.redo();\n                }\n                \n                // Ctrl/Cmd + S: Save\n                if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n                    e.preventDefault();\n                    this.saveImage();\n                }\n                \n                // Tool shortcuts\n                switch (e.key.toLowerCase()) {\n                    case 'v':\n                        this.selectTool('move');\n                        break;\n                    case 'b':\n                        this.selectTool('brush');\n                        break;\n                    case 'e':\n                        this.selectTool('eraser');\n                        break;\n                    case 'i':\n                        this.selectTool('eyedropper');\n                        break;\n                    case 't':\n                        this.selectTool('text');\n                        break;\n                    case 'm':\n                        this.selectTool('rect');\n                        break;\n                    case 'l':\n                        this.selectTool('lasso');\n                        break;\n                    case 'w':\n                        this.selectTool('magicwand');\n                        break;\n                    case 'z':\n                        this.selectTool('zoom');\n                        break;\n                    case 'h':\n                        this.selectTool('hand');\n                        break;\n                    case 's':\n                        this.selectTool('clonestamp');\n                        break;\n                    case 'p':\n                        this.selectTool('pencil');\n                        break;\n                }\n                \n                // Ctrl/Cmd + +: Zoom in\n                if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '=')) {\n                    e.preventDefault();\n                    this.zoom = Math.min(this.zoom * 1.1, 5);\n                    this.updateZoom();\n                }\n                \n                // Ctrl/Cmd + -: Zoom out\n                if ((e.ctrlKey || e.metaKey) && e.key === '-') {\n                    e.preventDefault();\n                    this.zoom = Math.max(this.zoom / 1.1, 0.1);\n                    this.updateZoom();\n                }\n                \n                // Ctrl/Cmd + 0: Reset zoom\n                if ((e.ctrlKey || e.metaKey) && e.key === '0') {\n                    e.preventDefault();\n                    this.zoom = 1;\n                    this.updateZoom();\n                }\n            },\n            \n            updateZoom() {\n                const canvasContainer = document.getElementById('canvas-container');\n                canvasContainer.style.transform = `scale(${this.zoom})`;\n                document.getElementById('zoom-level').textContent = `${Math.round(this.zoom * 100)}%`;\n            }\n        };\n        \n        // Initialize the app when the page loads\n        window.addEventListener('DOMContentLoaded', () => {\n            app.init();\n        });\n    </script>\n</body>\n</html>"
}