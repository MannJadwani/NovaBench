<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Flight Glass Cockpit System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    colors: {
                        glass: 'rgba(20, 25, 35, 0.85)',
                        glassBorder: 'rgba(255, 255, 255, 0.1)',
                        primary: '#00d2ff',
                        warning: '#ffcc00',
                        danger: '#ff3333',
                        success: '#00ff66',
                        dim: 'rgba(255,255,255,0.3)'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            color: #e0e0e0;
            overflow: hidden;
        }
        
        /* CRT/Scanline Effect */
        .scanlines::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 50;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
        
        .bezel {
            box-shadow: inset 0 0 20px #000, 0 0 10px rgba(0,0,0,0.8);
            border: 12px solid #1a1a1a;
            border-radius: 10px;
            position: relative;
        }

        /* Custom Scrollbar for lists */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }

        /* Rotary Knob Animation placeholder */
        .knob {
            transition: transform 0.1s;
        }

        /* Horizon Gradient */
        .sky { background: linear-gradient(to bottom, #0055aa 0%, #0088cc 100%); }
        .ground { background: linear-gradient(to bottom, #5c4033 0%, #3e2b22 100%); }
    </style>
</head>
<body class="h-screen w-screen flex flex-col font-mono text-sm select-none">

    <!-- TOP BAR: Status & Annunciators -->
    <div class="h-12 bg-black border-b border-gray-800 flex items-center justify-between px-4 z-50 relative">
        <div class="flex items-center space-x-4">
            <div class="text-primary font-bold text-lg tracking-widest">AERO-SYS <span class="text-xs text-gray-500">v4.2.1</span></div>
            <div class="flex space-x-2" id="master-warning-panel">
                <!-- Warning/Caution Lights populated by JS -->
            </div>
        </div>
        <div class="flex items-center space-x-6 text-xs">
            <div class="flex flex-col items-end">
                <span class="text-gray-500">UTC TIME</span>
                <span class="text-white font-bold text-base" id="clock">12:00:00</span>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-gray-500">BAT</span>
                <span class="text-success">28.2V</span>
            </div>
        </div>
    </div>

    <!-- MAIN COCKPIT DISPLAYS -->
    <div class="flex-1 flex bg-black relative scanlines">
        
        <!-- LEFT: PFD (Primary Flight Display) -->
        <div class="w-1/3 p-2 flex flex-col">
            <div class="bezel flex-1 bg-black relative overflow-hidden scanlines" id="pfd-container">
                <!-- PFD Canvas -->
                <canvas id="pfd-canvas" class="w-full h-full"></canvas>
                
                <!-- Synthetic Vision/Attitude Overlay -->
                <div id="attitude-overlay" class="absolute inset-0 pointer-events-none flex items-center justify-center overflow-hidden">
                    <div id="horizon-line" class="w-[200%] h-[200%] sky relative transition-transform duration-75 ease-linear" style="transform: rotate(0deg) translateY(0px);">
                        <div class="absolute bottom-1/2 top-0 w-full sky"></div> <!-- Sky -->
                        <div class="absolute top-1/2 bottom-0 w-full ground border-t-4 border-white"></div> <!-- Ground -->
                        <!-- Pitch Ladder (Visual only, handled in canvas mostly but this adds depth) -->
                        <div class="absolute top-1/2 left-1/2 w-full -translate-x-1/2 flex flex-col items-center opacity-80">
                             <!-- Generated via JS for dynamic pitch -->
                        </div>
                    </div>
                </div>

                <!-- Flight Director / FP Symbol -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div id="flight-director" class="w-16 h-16 border-2 border-primary rounded-full opacity-80 flex items-center justify-center transition-all duration-300">
                        <div class="w-2 h-2 bg-primary rounded-full"></div>
                        <div class="absolute w-8 h-0.5 bg-primary"></div>
                        <div class="absolute h-8 w-0.5 bg-primary"></div>
                    </div>
                    <!-- Fixed Aircraft Reference -->
                    <div class="absolute w-48 h-1 bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.8)]"></div>
                    <div class="absolute w-1 h-6 bg-yellow-400 -ml-24"></div>
                    <div class="absolute w-1 h-6 bg-yellow-400 ml-24"></div>
                </div>

                <!-- Airspeed Tape (Left) -->
                <div class="absolute left-4 top-10 bottom-10 w-16 flex flex-col items-center justify-center overflow-hidden pointer-events-none">
                    <div id="spd-tape" class="absolute text-center transition-transform duration-75">
                        <!-- Generated by JS -->
                    </div>
                    <div class="absolute right-0 w-0 h-0 border-t-[10px] border-t-transparent border-l-[15px] border-l-warning border-b-[10px] border-b-transparent z-10"></div>
                    <div class="absolute bottom-[-20px] text-3xl font-bold text-primary drop-shadow-md" id="spd-readout">240</div>
                </div>

                <!-- Altitude Tape (Right) -->
                <div class="absolute right-4 top-10 bottom-10 w-20 flex flex-col items-center justify-center overflow-hidden pointer-events-none">
                    <div id="alt-tape" class="absolute text-center transition-transform duration-75">
                        <!-- Generated by JS -->
                    </div>
                    <div class="absolute left-0 w-0 h-0 border-t-[10px] border-t-transparent border-r-[15px] border-r-warning border-b-[10px] border-b-transparent z-10"></div>
                    <div class="absolute bottom-[-20px] text-3xl font-bold text-primary drop-shadow-md" id="alt-readout">15200</div>
                </div>
                
                <!-- Heading Strip (Bottom) -->
                <div class="absolute bottom-2 left-10 right-10 h-12 overflow-hidden border-t border-white/20 pointer-events-none">
                     <div id="hdg-tape" class="flex items-center h-full transition-transform duration-75">
                        <!-- Generated by JS -->
                     </div>
                     <div class="absolute left-1/2 top-0 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[10px] border-t-warning z-10"></div>
                </div>

                <!-- AP Status (Top Center) -->
                <div class="absolute top-4 left-1/2 -translate-x-1/2 flex space-x-2 text-[10px] font-bold bg-black/50 px-2 py-1 rounded border border-white/10">
                    <span class="text-green-400">LNV</span>
                    <span class="text-green-400">VNAV</span>
                    <span class="text-primary">FLC</span>
                    <span class="text-white">ALT</span>
                </div>
            </div>
        </div>

        <!-- CENTER: ND (Navigation Display) -->
        <div class="w-1/3 p-2 flex flex-col">
            <div class="bezel flex-1 bg-black relative overflow-hidden">
                <canvas id="nd-canvas" class="w-full h-full"></canvas>
                <!-- Map Overlays -->
                <div class="absolute top-4 left-4 text-xs">
                    <div class="text-primary font-bold">ROSE NAV</div>
                    <div class="text-white">TERR</div>
                </div>
                <div class="absolute top-4 right-4 text-right text-xs">
                    <div class="text-xs text-gray-400">NEXT WAYPOINT</div>
                    <div class="text-primary font-bold text-lg">KSEA</div>
                    <div class="text-white">45.2 NM</div>
                </div>
                <!-- VOR Info -->
                <div class="absolute bottom-4 left-4 text-xs bg-black/60 p-2 rounded border border-gray-700">
                    <div class="flex justify-between space-x-4">
                        <span class="text-primary">VOR1</span>
                        <span>110.50</span>
                        <span class="text-warning">TO</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: EICAS (Engine + Systems) -->
        <div class="w-1/3 p-2 flex flex-col">
            <div class="bezel flex-1 bg-black relative p-4 flex flex-col justify-between overflow-hidden">
                
                <!-- Engine Gauges -->
                <div class="grid grid-cols-2 gap-4 mb-2">
                    <div class="flex flex-col">
                        <div class="flex justify-between text-xs mb-1"><span>N1</span> <span class="text-primary" id="n1-val">88.4%</span></div>
                        <div class="h-4 bg-gray-800 rounded overflow-hidden relative border border-gray-600">
                            <div id="n1-bar" class="h-full bg-gradient-to-r from-green-500 to-green-300 w-[88%] transition-all duration-500"></div>
                            <div class="absolute top-0 bottom-0 left-[95%] w-0.5 bg-red-500"></div> <!-- Redline -->
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div class="flex justify-between text-xs mb-1"><span>N2</span> <span class="text-primary" id="n2-val">91.2%</span></div>
                        <div class="h-4 bg-gray-800 rounded overflow-hidden relative border border-gray-600">
                            <div id="n2-bar" class="h-full bg-gradient-to-r from-green-500 to-green-300 w-[91%] transition-all duration-500"></div>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div class="flex justify-between text-xs mb-1"><span>EGT</span> <span class="text-warning" id="egt-val">560°C</span></div>
                        <div class="h-4 bg-gray-800 rounded overflow-hidden relative border border-gray-600">
                            <div id="egt-bar" class="h-full bg-gradient-to-r from-orange-500 to-red-500 w-[65%] transition-all duration-500"></div>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div class="flex justify-between text-xs mb-1"><span>F.FLOW</span> <span class="text-white">2400</span></div>
                        <div class="text-right text-[10px] text-gray-500">PPH</div>
                    </div>
                </div>

                <!-- Artificial Horizon Backup -->
                <div class="flex-1 border border-gray-700 rounded relative overflow-hidden bg-gradient-to-b from-gray-900 to-black">
                     <div class="absolute top-1/2 w-full h-[1px] bg-white opacity-30"></div>
                     <div class="absolute left-1/2 h-full w-[1px] bg-white opacity-30"></div>
                     <!-- TCAS Traffic Widget -->
                     <div class="absolute top-4 right-4 w-24 h-24 border border-gray-600 rounded-full opacity-60 bg-gray-900/50 flex items-center justify-center">
                        <div class="w-1 h-1 bg-white"></div> <!-- Ownship -->
                        <div class="absolute w-2 h-2 bg-danger rounded-full top-6 left-10 animate-pulse"></div> <!-- Threat -->
                     </div>
                     <div class="absolute bottom-2 left-2 text-[10px] text-gray-400">
                        OAT: -12°C<br>
                        SAT: -24°C<br>
                        TAT: -8°C
                     </div>
                </div>
                
                <!-- Landing Gear Visual -->
                <div class="mt-2 flex justify-center space-x-4">
                    <div class="flex flex-col items-center">
                        <div class="w-6 h-6 border border-gray-500 rounded-full flex items-center justify-center text-[10px] text-green-400 font-bold bg-gray-800/50">L</div>
                        <span class="text-[9px] text-gray-500 mt-1">GR</span>
                    </div>
                     <div class="flex flex-col items-center">
                        <div class="w-6 h-6 border border-gray-500 rounded-full flex items-center justify-center text-[10px] text-green-400 font-bold bg-gray-800/50">N</div>
                        <span class="text-[9px] text-gray-500 mt-1">GR</span>
                    </div>
                     <div class="flex flex-col items-center">
                        <div class="w-6 h-6 border border-gray-500 rounded-full flex items-center justify-center text-[10px] text-green-400 font-bold bg-gray-800/50">R</div>
                        <span class="text-[9px] text-gray-500 mt-1">GR</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOTTOM CONSOLE: Controls, Autopilot, FMS -->
    <div class="h-64 bg-[#0f1115] border-t border-gray-700 grid grid-cols-12 gap-2 p-2 z-40 shadow-[0_-5px_20px_rgba(0,0,0,0.8)]">
        
        <!-- COM Panel -->
        <div class="col-span-2 bg-gray-900 rounded border border-gray-700 p-3 flex flex-col justify-between">
            <div class="text-[10px] text-gray-500 font-bold mb-1">RADIO / COM</div>
            <div class="bg-black p-2 rounded border border-gray-600 mb-2 relative overflow-hidden">
                <div class="text-right text-xl text-primary font-mono tracking-widest" id="com-display">124.850</div>
                <div class="absolute bottom-1 right-2 text-[8px] text-gray-600">VHF1</div>
            </div>
            <div class="grid grid-cols-3 gap-1">
                <button class="bg-gray-800 hover:bg-gray-700 text-xs p-2 rounded border border-gray-600 text-white transition" onclick="tuneRadio(-0.025)">◀</button>
                <button class="bg-gray-800 hover:bg-gray-700 text-xs p-2 rounded border border-gray-600 text-primary font-bold transition" onclick="swapRadio()">⇄</button>
                <button class="bg-gray-800 hover:bg-gray-700 text-xs p-2 rounded border border-gray-600 text-white transition" onclick="tuneRadio(0.025)">▶</button>
            </div>
        </div>

        <!-- Mode Control Panel (MCP) / Autopilot -->
        <div class="col-span-5 bg-gray-900 rounded border border-gray-700 p-3 grid grid-cols-2 gap-4 relative">
            <div class="absolute top-0 left-0 bg-gray-700 text-[9px] px-2 py-0.5 text-white rounded-br">MODE CONTROL PANEL</div>
            
            <!-- Left Knobs -->
            <div class="flex flex-col justify-center space-y-4">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 border-2 border-gray-600 shadow-lg flex items-center justify-center cursor-pointer active:scale-95 transition group" onclick="adjustAlt(-100)">
                        <div class="w-1 h-4 bg-white rounded"></div>
                        <div class="absolute text-[8px] -bottom-4 text-gray-500">SPD</div>
                    </div>
                    <div class="flex-1 bg-black border border-gray-600 rounded px-2 py-1 text-center text-primary font-mono text-lg">FLC</div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 border-2 border-gray-600 shadow-lg flex items-center justify-center cursor-pointer active:scale-95 transition" onclick="adjustAlt(-100)">
                         <div class="w-1 h-4 bg-white rounded"></div>
                         <div class="absolute text-[8px] -bottom-4 text-gray-500">HDG</div>
                    </div>
                    <div class="flex-1 bg-black border border-gray-600 rounded px-2 py-1 text-center text-primary font-mono text-lg" id="hdg-val">245°</div>
                </div>
            </div>

            <!-- Right Knobs -->
            <div class="flex flex-col justify-center space-y-4">
                 <div class="flex items-center space-x-3">
                    <div class="flex-1 bg-black border border-gray-600 rounded px-2 py-1 text-center text-primary font-mono text-lg" id="alt-val">FL280</div>
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 border-2 border-gray-600 shadow-lg flex items-center justify-center cursor-pointer active:scale-95 transition" onclick="adjustAlt(100)">
                         <div class="w-1 h-4 bg-white rounded"></div>
                         <div class="absolute text-[8px] -bottom-4 text-gray-500">ALT</div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex-1 bg-black border border-gray-600 rounded px-2 py-1 text-center text-primary font-mono text-lg">VS +1200</div>
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 border-2 border-gray-600 shadow-lg flex items-center justify-center cursor-pointer active:scale-95 transition">
                         <div class="w-1 h-4 bg-white rounded"></div>
                         <div class="absolute text-[8px] -bottom-4 text-gray-500">V/S</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FMS / FMC -->
        <div class="col-span-3 bg-black rounded border-2 border-gray-600 p-2 flex flex-col font-mono">
            <div class="bg-[#1a1a20] flex-1 p-2 rounded text-xs grid grid-cols-2 gap-x-4 leading-relaxed" id="fms-screen">
                <!-- Dynamic FMS Content -->
                <div class="col-span-2 text-center text-gray-400 mb-1">--- RTE 1 LEGS ---</div>
                <div class="text-white">WPT</div>
                <div class="text-right text-primary">DIST</div>
                
                <div class="text-white">KBFI</div>
                <div class="text-right text-primary">0.0</div>
                
                <div class="text-white">SEA</div>
                <div class="text-right text-primary">5.2</div>
                
                <div class="text-green-400">►OLM</div>
                <div class="text-right text-green-400">48.5</div>
                
                <div class="text-white">HQM</div>
                <div class="text-right text-primary">22.1</div>
                
                <div class="text-gray-500">KSEA</div>
                <div class="text-right text-gray-500">45.2</div>
            </div>
        </div>

        <!-- Annunciator Panel Controls -->
        <div class="col-span-2 grid grid-rows-3 gap-2">
            <button class="bg-gray-800 border border-gray-600 rounded text-danger font-bold text-xs hover:bg-gray-700 active:bg-red-900 transition flex items-center justify-center flex-col shadow-lg" onclick="toggleWarning('MASTER WARN')">
                <span class="text-lg">⚠</span> MASTER WARN
            </button>
            <button class="bg-gray-800 border border-gray-600 rounded text-warning font-bold text-xs hover:bg-gray-700 active:bg-yellow-900 transition flex items-center justify-center flex-col shadow-lg" onclick="toggleWarning('MASTER CAUT')">
                <span class="text-lg">!</span> MASTER CAUT
            </button>
            <button class="bg-gray-800 border border-gray-600 rounded text-primary font-bold text-xs hover:bg-gray-700 active:bg-blue-900 transition flex items-center justify-center shadow-lg" onclick="clearWarnings()">
                CLR MSG
            </button>
        </div>
    </div>

    <script>
        /* --- STATE MANAGEMENT --- */
        const state = {
            pitch: 0, // degrees
            roll: 0,  // degrees
            heading: 245,
            altitude: 15200,
            speed: 240,
            targetAlt: 280,
            targetHdg: 245,
            vSpeed: 1200,
            engine: {
                n1: 88.4,
                n2: 91.2,
                egt: 560
            },
            radio: 124.850,
            warnings: [],
            waypoints: [
                {id: 'KBFI', x: 0.2, y: 0.8},
                {id: 'SEA', x: 0.3, y: 0.6},
                {id: 'OLM', x: 0.5, y: 0.4},
                {id: 'HQM', x: 0.7, y: 0.3},
                {id: 'KSEA', x: 0.9, y: 0.1}
            ]
        };

        /* --- PFD RENDERING --- */
        const pfdCanvas = document.getElementById('pfd-canvas');
        const pfdCtx = pfdCanvas.getContext('2d');
        const horizonEl = document.getElementById('horizon-line');
        const spdTape = document.getElementById('spd-tape');
        const altTape = document.getElementById('alt-tape');
        const hdgTape = document.getElementById('hdg-tape');

        function resizeCanvas() {
            pfdCanvas.width = pfdCanvas.parentElement.clientWidth;
            pfdCanvas.height = pfdCanvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Initialize tapes
        function initTapes() {
            let spdHtml = '';
            for(let i = 50; i <= 450; i+=5) {
                spdHtml += `<div class="h-6 text-xs text-white w-full text-right pr-2 border-r border-gray-500 relative">
                    <span class="${i%10===0?'font-bold text-sm':''}">${i}</span>
                    ${i%10===0?'<div class="absolute right-0 top-1/2 w-2 h-[1px] bg-white"></div>':''}
                </div>`;
            }
            spdTape.innerHTML = spdHtml;

            let altHtml = '';
            for(let i = 0; i <= 50000; i+=100) {
                altHtml += `<div class="h-8 text-xs text-white w-full text-left pl-2 border-l border-gray-500 relative flex items-center">
                    <span class="${i%500===0?'font-bold text-sm':''}">${i}</span>
                    ${i%500===0?'<div class="absolute left-0 top-1/2 w-2 h-[1px] bg-white"></div>':''}
                </div>`;
            }
            altTape.innerHTML = altHtml;

            let hdgHtml = '';
            const directions = ['N', '3', '6', 'E', '12', '15', 'S', '21', '24', 'W', '30', '33'];
            for(let i=0; i<12; i++) {
                let deg = i * 30;
                hdgHtml += `<div class="w-12 flex-shrink-0 text-center relative pt-2">
                    <div class="h-2 border-l border-white mx-auto mb-1"></div>
                    <span class="text-xs font-bold ${i%3===0?'text-white':'text-gray-500'}">${i%3===0 ? directions[i] : deg}</span>
                </div>`;
            }
            hdgTape.innerHTML = hdgHtml;
        }
        initTapes();

        /* --- ND (NAV) RENDERING --- */
        const ndCanvas = document.getElementById('nd-canvas');
        const ndCtx = ndCanvas.getContext('2d');

        function updateNavDisplay() {
            ndCanvas.width = ndCanvas.parentElement.clientWidth;
            ndCanvas.height = ndCanvas.parentElement.clientHeight;
            
            const cx = ndCanvas.width / 2;
            const cy = ndCanvas.height / 2;
            const radius = Math.min(cx, cy) * 0.9;

            ndCtx.clearRect(0, 0, ndCanvas.width, ndCanvas.height);

            // Compass Rose
            ndCtx.strokeStyle = '#333';
            ndCtx.lineWidth = 2;
            ndCtx.beginPath();
            ndCtx.arc(cx, cy, radius, 0, Math.PI * 2);
            ndCtx.stroke();

            // Heading Indicators on Rose
            for(let i=0; i<360; i+=30) {
                const rad = (i - 90) * Math.PI / 180;
                const x1 = cx + Math.cos(rad) * radius;
                const y1 = cy + Math.sin(rad) * radius;
                const x2 = cx + Math.cos(rad) * (radius - 10);
                const y2 = cy + Math.sin(rad) * (radius - 10);
                
                ndCtx.beginPath();
                ndCtx.moveTo(x1, y1);
                ndCtx.lineTo(x2, y2);
                ndCtx.strokeStyle = i === 0 ? '#ff3333' : '#666';
                ndCtx.stroke();
            }

            // Rotated Map Content (Simulated)
            // In a real system, everything rotates based on heading. Here we simplify to view mode.
            
            // Draw Route Line
            ndCtx.beginPath();
            ndCtx.strokeStyle = '#d4af37'; // Magenta/Dark Gold
            ndCtx.lineWidth = 3;
            ndCtx.setLineDash([5, 5]);
            
            // Draw Arc Route
            state.waypoints.forEach((wp, index) => {
                const wx = cx + (wp.x - 0.5) * radius * 1.5;
                const wy = cy + (wp.y - 0.5) * radius * 1.5;
                if(index === 0) ndCtx.moveTo(wx, wy);
                else ndCtx.lineTo(wx, wy);
                
                // Draw WP Circle
                ndCtx.fillStyle = 'black';
                ndCtx.strokeStyle = '#d4af37';
                ndCtx.lineWidth = 2;
                ndCtx.setLineDash([]);
                ndCtx.beginPath();
                ndCtx.arc(wx, wy, 5, 0, Math.PI*2);
                ndCtx.fill();
                ndCtx.stroke();
                
                // Text
                ndCtx.fillStyle = '#fff';
                ndCtx.font = '10px monospace';
                ndCtx.fillText(wp.id, wx + 8, wy + 3);
            });
            ndCtx.stroke();

            // Ownship
            ndCtx.fillStyle = '#000';
            ndCtx.strokeStyle = '#fff';
            ndCtx.lineWidth = 2;
            ndCtx.beginPath();
            ndCtx.moveTo(cx, cy - 10);
            ndCtx.lineTo(cx + 8, cy + 5);
            ndCtx.lineTo(cx - 8, cy + 5);
            ndCtx.closePath();
            ndCtx.fill();
            ndCtx.stroke();
            
            // VOR Needle
            const vorRad = 45 * Math.PI / 180; // Fake VOR bearing
            ndCtx.save();
            ndCtx.translate(cx, cy);
            ndCtx.rotate(vorRad);
            ndCtx.strokeStyle = '#00d2ff';
            ndCtx.lineWidth = 2;
            ndCtx.beginPath();
            ndCtx.moveTo(0, -radius + 10);
            ndCtx.lineTo(0, -20);
            ndCtx.moveTo(0, 20);
            ndCtx.lineTo(0, radius - 10);
            ndCtx.stroke();
            ndCtx.restore();
        }

        /* --- MAIN LOOP --- */
        function updateDisplays() {
            // 1. Update Tapes Position
            // Speed: 12px per unit approx.
            const spdOffset = (state.speed - 50) * 6; 
            spdTape.style.transform = `translateY(${spdOffset}px)`;
            document.getElementById('spd-readout').innerText = Math.floor(state.speed);

            // Alt: 2px per 100ft? 
            // Ticks are h-8 (32px) for 100ft. So 0.32px per ft.
            const altOffset = (state.altitude / 50) * 6; // Rough scaling
            altTape.style.transform = `translateY(${altOffset}px)`;
            document.getElementById('alt-readout').innerText = Math.floor(state.altitude);

            // Hdg: 12 items. width 48px each.
            const hdgOffset = (state.heading / 30) * 48 * -1 + (hdgTape.parentElement.clientWidth/2) - 24;
            hdgTape.style.transform = `translateX(${hdgOffset}px)`;
            
            // 2. Update Horizon
            // Pitch: 1 deg = 5px roughly
            // Roll: CSS rotate
            const pitchPx = state.pitch * 8;
            horizonEl.style.transform = `rotate(${-state.roll}deg) translateY(${pitchPx}px)`;

            // 3. Draw PFD Overlays (Pitch Ladder, FD)
            drawPFDOverlays();

            // 4. Update Engine Bars
            document.getElementById('n1-bar').style.width = state.engine.n1 + '%';
            document.getElementById('n1-val').innerText = state.engine.n1.toFixed(1) + '%';
            
            document.getElementById('n2-bar').style.width = state.engine.n2 + '%';
            document.getElementById('n2-val').innerText = state.engine.n2.toFixed(1) + '%';
            
            document.getElementById('egt-bar').style.width = (state.engine.egt / 10) + '%';
            document.getElementById('egt-val').innerText = Math.floor(state.engine.egt) + '°C';

            // 5. ND
            updateNavDisplay();

            // 6. Clock
            const now = new Date();
            document.getElementById('clock').innerText = now.toISOString().split('T')[1].split('.')[0];
        }

        function drawPFDOverlays() {
            const w = pfdCanvas.width;
            const h = pfdCanvas.height;
            pfdCtx.clearRect(0, 0, w, h);

            // Draw Pitch Ladder Lines on Canvas (Perspective)
            pfdCtx.save();
            pfdCtx.translate(w/2, h/2);
            pfdCtx.rotate(-state.roll * Math.PI / 180);
            pfdCtx.translate(0, state.pitch * 8); // Move opposite to horizon translation logic or sync with it

            pfdCtx.strokeStyle = 'white';
            pfdCtx.lineWidth = 2;
            pfdCtx.fillStyle = 'white';
            pfdCtx.textAlign = 'center';
            pfdCtx.font = '14px monospace';

            // Draw pitch lines (-20 to +20 deg)
            for(let i = -20; i <= 20; i+=5) {
                if(i === 0) continue; // Horizon line is handled by the DOM div gradient mask
                const y = -i * 8; // 8px per degree
                let width = 20;
                if(i % 10 === 0) width = 40;
                
                pfdCtx.beginPath();
                pfdCtx.moveTo(-width, y);
                pfdCtx.lineTo(width, y);
                pfdCtx.stroke();

                if(i % 10 === 0) {
                    pfdCtx.fillText(i, -width - 10, y + 4);
                    pfdCtx.fillText(i, width + 10, y + 4);
                }
            }
            pfdCtx.restore();
        }

        /* --- INTERACTION LOGIC --- */
        
        // Simulate flight dynamics
        setInterval(() => {
            // Oscillate slightly
            const time = Date.now() / 1000;
            state.roll = Math.sin(time) * 2; 
            state.pitch = Math.sin(time * 0.7) * 1 + 2;
            
            // Slowly move speed/alt based on AP
            if(state.altitude < state.targetAlt * 100) state.altitude += 10;
            if(state.altitude > state.targetAlt * 100) state.altitude -= 10;
            
            // Random engine fluctuation
            state.engine.n1 = 88.4 + (Math.random() - 0.5);
            state.engine.egt = 560 + (Math.random() * 10 - 5);

            updateDisplays();
        }, 50);

        function adjustAlt(amount) {
            state.targetAlt += amount;
            document.getElementById('alt-val').innerText = `FL${Math.floor(state.targetAlt/100)}`;
            // Visual feedback on button screen could go here
        }

        function tuneRadio(amount) {
            state.radio += amount;
            document.getElementById('com-display').innerText = state.radio.toFixed(3);
        }

        function swapRadio() {
            const el = document.getElementById('com-display');
            el.classList.add('text-warning');
            setTimeout(() => el.classList.remove('text-warning'), 200);
        }

        /* --- WARNING SYSTEM --- */
        const warningPanel = document.getElementById('master-warning-panel');
        
        function toggleWarning(type) {
            const id = Date.now();
            const el = document.createElement('div');
            el.className = `px-2 py-1 rounded text-xs font-bold animate-pulse border border-white ${type === 'MASTER WARN' ? 'bg-danger text-white' : 'bg-warning text-black'}`;
            el.innerText = type;
            el.id = `warn-${id}`;
            
            // Remove previous if exists to avoid clutter
            if(warningPanel.children.length > 3) warningPanel.innerHTML = '';
            
            warningPanel.appendChild(el);
            state.warnings.push({id, el});
        }

        function clearWarnings() {
            warningPanel.innerHTML = '';
            state.warnings = [];
        }

        /* --- FMS INTERACTION SIMULATOR --- */
        // Just a visual toggle for the FMS list for now to show interactivity
        const fmsScreen = document.getElementById('fms-screen');
        let fmsActive = 2; // OLM active
        
        // Simulate progression
        setInterval(() => {
            const rows = fmsScreen.innerHTML.split('</div>').filter(r => r.includes('WPT') || r.includes('KBFI') || r.includes('SEA') || r.includes('OLM') || r.includes('HQM') || r.includes('KSEA') || r.includes('text-gray'));
            // This is a messy way to parse HTML string, but for a pure HTML/JS file without a framework, it's proof of concept.
            // In a real app, we'd template this properly.
        }, 5000);

        // Initial render
        updateDisplays();

    </script>
</body>
</html>